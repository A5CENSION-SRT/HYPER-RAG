{# templates/base.html - The Master Blueprint #}
<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <title>{% block title %}RAG Engine{% endblock %}</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primaryDark: "#0d0f13",
              secondaryText: "#d1d5db",
              mutedText: "#9ca3af",
              accentPrimary: "#6366f1",
              accentSecondary: "#38bdf8",
              feedbackYellow: "#facc15",
              feedbackGreen: "#22c55e",
              sidebar: {
                bg: "#0D0E14",
                accent: "#1b1f27",
                hover: "#232832",
                border: "#2d3340",
              },
            },
          },
        },
      };
    </script>
    <style>
      .sidebar-transition {
        transition: transform 0.28s ease, opacity 0.28s ease;
      }
      .msg-bubble {
        max-width: 72%;
        white-space: pre-wrap;
        word-break: break-word;
      }
      html,
      body {
        height: 100%;
      }
    </style>
    {% block head %}
    
    {% endblock %}
  </head>
  <body class="h-full bg-primaryDark text-secondaryText font-sans antialiased">
    <!-- Mobile top bar (shows hamburger) -->
    <header
      class="lg:hidden flex items-center justify-between px-4 py-3 border-b border-sidebar-border bg-sidebar-accent/60 backdrop-blur"
    >
      <div class="flex items-center gap-2">
        <button
          id="mobileMenuBtn"
          aria-label="Open sidebar"
          class="p-2 rounded-md border border-sidebar-border hover:bg-sidebar-hover focus:outline-none focus:ring-2 focus:ring-accentPrimary"
        >
          <svg
            class="w-6 h-6 text-mutedText"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            viewBox="0 0 24 24"
          >
            <path d="M3 6h18M3 12h18M3 18h18" />
          </svg>
        </button>
        <span class="text-lg font-semibold tracking-wide text-secondaryText"
          >RAG Engine</span
        >
      </div>
    </header>

    <div class="h-full flex">
      <!-- Overlay (click to close on mobile) -->
      <div
        id="overlay"
        class="fixed inset-0 bg-black/50 opacity-0 pointer-events-none transition-opacity lg:hidden z-30"
      ></div>

      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="sidebar-transition fixed z-40 inset-y-0 left-0 w-72 flex flex-col bg-sidebar-bg border-r border-sidebar-border translate-x-[-100%] opacity-0 lg:translate-x-0 lg:opacity-100"
      >
        <div class="px-5 pt-5 pb-4 border-b border-sidebar-border">
          <h1
            class="text-xl font-bold tracking-wide bg-gradient-to-r from-accentPrimary to-accentSecondary bg-clip-text text-transparent"
          >
            RAG Engine
          </h1>
          <div class="mt-5 space-y-2">
            <button
              class="group w-full inline-flex items-center justify-center gap-2 rounded-md bg-accentPrimary hover:bg-indigo-500 text-sm font-medium px-4 py-2.5 text-white shadow focus:outline-none focus:ring-2 focus:ring-accentPrimary/60"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                viewBox="0 0 24 24"
              >
                <path d="M12 5v14M5 12h14" />
              </svg>
              New Chat
            </button>
            <a
              href="#"
              class="group flex items-center gap-2 text-sm font-medium px-3 py-2 rounded-md bg-sidebar-accent/60 border border-sidebar-border hover:bg-sidebar-hover transition-colors"
            >
              <svg
                class="w-5 h-5 text-mutedText group-hover:text-secondaryText"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                viewBox="0 0 24 24"
              >
                <path d="M3 7h5l2 3h11v7a2 2 0 0 1-2 2H3z" />
                <path d="M3 7V5a2 2 0 0 1 2-2h5l2 2h7a2 2 0 0 1 2 2v3H10.5" />
              </svg>
              Browse Files
            </a>
          </div>
        </div>
        <div class="flex-1 flex flex-col min-h-0">
          <div class="px-5 pt-4 pb-2 flex items-center justify-between">
            <h2
              class="text-xs uppercase tracking-wider font-semibold text-mutedText"
            >
              Chats
            </h2>
          </div>
          <nav
            class="flex-1 overflow-y-auto px-2 pb-4 space-y-1"
            aria-label="Chat history"
          >
            {% for c in chats|default([]) %}
            <a
              href="{{ c.href or '#' }}"
              class="group flex items-center gap-3 px-3 py-2 rounded-md text-sm {{ 'bg-sidebar-accent/40' if c.active else '' }} hover:bg-sidebar-hover transition-colors"
            >
              <svg
                class="w-5 h-5 text-mutedText group-hover:text-accentPrimary"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                viewBox="0 0 24 24"
              >
                <path
                  d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.5 8.5 0 0 1 8 8v.5z"
                />
              </svg>
              <span class="truncate text-secondaryText">{{ c.title }}</span>
            </a>
            {% else %}
            <p class="px-3 text-sm text-mutedText">No chats yet.</p>
            {% endfor %}
          </nav>
        </div>
        <div class="border-t border-sidebar-border p-4">
          <a
            href="#"
            class="group flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium text-secondaryText hover:text-white hover:bg-sidebar-hover transition-colors"
          >
            <svg
              class="w-5 h-5 text-mutedText group-hover:text-accentPrimary"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              viewBox="0 0 24 24"
            >
              <circle cx="12" cy="12" r="3" />
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.6a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09c0 .67.4 1.27 1 1.51.61.24 1.31.1 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06c-.43.51-.57 1.21-.33 1.82.24.61.84 1 1.51 1H21a2 2 0 1 1 0 4h-.09c-.67 0-1.27.4-1.51 1z"
              />
            </svg>
            Settings
          </a>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="flex-1 lg:ml-72 min-h-screen flex flex-col">
        {# This block is the placeholder for page-specific content. #} {% block
        content %}
        
        
        {% endblock %}
      </main>
    </div>

    <!-- Mobile Sidebar Toggle Script -->
    <script>
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("overlay");
      const btn = document.getElementById("mobileMenuBtn");
      function openSidebar() {
        sidebar.style.transform = "translateX(0)";
        sidebar.style.opacity = "1";
        overlay.classList.remove("pointer-events-none");
        overlay.style.opacity = "1";
        document.body.style.overflow = "hidden";
      }
      function closeSidebar() {
        sidebar.style.transform = "translateX(-100%)";
        sidebar.style.opacity = "0";
        overlay.classList.add("pointer-events-none");
        overlay.style.opacity = "0";
        document.body.style.overflow = "";
      }
      btn?.addEventListener("click", () => {
        const isHidden =
          sidebar.style.transform.includes("-100%") || !sidebar.style.transform;
        isHidden ? openSidebar() : closeSidebar();
      });
      overlay?.addEventListener("click", closeSidebar);
      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeSidebar();
      });
      window.addEventListener("resize", () => {
        if (window.innerWidth >= 1024) {
          openSidebar();
        } else {
          closeSidebar();
        }
      });
    </script>
    {% block scripts %}{% endblock %}
  </body>
</html>
